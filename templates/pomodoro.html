{% extends "layout.html" %}

{% block title %}Pomodoro Odaklanma TekniÄŸi - StudyFlow{% endblock %}

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

{% block content %}
    <div class="page-header">
        <h1>ğŸ… Pomodoro Odaklanma TekniÄŸi</h1>
    </div>

    <div class="pomodoro-info-section card">
        <h2>Pomodoro Nedir ve FaydalarÄ± Nelerdir?</h2>
        <p>Pomodoro tekniÄŸi, odaklanmayÄ± artÄ±rmak ve zihinsel yorgunluÄŸu azaltmak iÃ§in sÃ¼reyi kÄ±sa aralÄ±klarla (genellikle 25 dakika Ã§alÄ±ÅŸma, 5 dakika mola) bÃ¶lerek Ã§alÄ±ÅŸmayÄ± teÅŸvik eden zaman yÃ¶netimi yÃ¶ntemidir.</p>
        
        <p><strong>Temel FaydalarÄ±:</strong></p>
        <ul>
            <li>âœ¨ OdaklanmayÄ± ArtÄ±rÄ±r: KÄ±sa Ã§alÄ±ÅŸma aralÄ±klarÄ±, dikkatin daÄŸÄ±lmasÄ±nÄ± zorlaÅŸtÄ±rÄ±r.</li>
            <li>â³ Ertelemeyi AzaltÄ±r: BaÅŸlamasÄ± gereken iÅŸi sadece 25 dakikalÄ±k bir taahhÃ¼de indirir.</li>
            <li>ğŸ§  Zihinsel DayanÄ±klÄ±lÄ±k: DÃ¼zenli molalar sayesinde uzun sÃ¼re verimli kalmanÄ±zÄ± saÄŸlar.</li>
        </ul>
    </div>
    <br>

    <div class="pomodoro-how-to-section card">
        <h2>Pomodoro TekniÄŸi NasÄ±l UygulanÄ±r?</h2>
        <ol>
            <li>GÃ¶revi SeÃ§in: BaÅŸlayacaÄŸÄ±nÄ±z dersi veya konuyu belirleyin.</li>
            <li>SÃ¼reyi AyarlayÄ±n: SayaÃ§ta Ã§alÄ±ÅŸma sÃ¼resini baÅŸlatÄ±n.</li>
            <li>Ã‡alÄ±ÅŸÄ±n: SayaÃ§ Ã§alana kadar dikkatiniz daÄŸÄ±lmadan sadece o gÃ¶reve odaklanÄ±n.</li>
            <li>KÄ±sa Mola Verin: SayaÃ§ Ã§aldÄ±ÄŸÄ±nda (genellikle 5 dakika), masadan kalkÄ±n ve dinlenin.</li>
            <li>Uzun Mola: 4 Pomodoro dÃ¶ngÃ¼sÃ¼nden sonra (yaklaÅŸÄ±k 2 saat), 15-30 dakikalÄ±k uzun bir mola verin.</li>
        </ol>
    </div>

    <hr>

    <div class="start-session-area" style="text-align: center; margin-top: 40px;">
        <h2>Hemen Bir Pomodoro Oturumu BaÅŸlatÄ±n!</h2>
        <button id="start-pomodoro-btn" class="btn btn-primary btn-large" 
                style="background-color: var(--secondary-fuchsia); font-size: 1.5em; padding: 15px 40px;">
            SayacÄ± BaÅŸlat ğŸš€
        </button>
    </div>

    <div id="pomodoro-modal" class="modal-fullscreen" style="display: none;">
        <div class="modal-content-pomodoro">
            <h2 id="modal-title">Pomodoro Oturumu SeÃ§in</h2>
            
            <div class="pomodoro-options">
                <button class="time-option" data-work="25" data-break="5">25 Dk Ã‡alÄ±ÅŸma / 5 Dk Mola</button>
                <button class="time-option" data-work="40" data-break="10">40 Dk Ã‡alÄ±ÅŸma / 10 Dk Mola</button>
                <button class="time-option" data-work="60" data-break="15">60 Dk Ã‡alÄ±ÅŸma / 15 Dk Mola</button>
            </div>

            <div id="timer-display" style="display: none;">
                <p id="timer-label" class="timer-label-text"></p>
                <div id="timer-time" class="timer-time-text">25:00</div>
            </div>

            <p class="exit-instruction">Ã‡Ä±kÄ±ÅŸ iÃ§in ESC tuÅŸuna basÄ±n</p>
        </div>
    </div>

{% endblock content %} 

{% block scripts %} 
<script>
    // DOM Elementleri
    const startPomodoroBtn = document.getElementById('start-pomodoro-btn');
    const pomodoroModal = document.getElementById('pomodoro-modal');
    const timeOptions = document.querySelectorAll('.time-option');
    const timerDisplay = document.getElementById('timer-display');
    const timerTime = document.getElementById('timer-time');

    let isRunning = false;
    let isWorkTime = true;
    let timerInterval;
    let remainingTime; 
    let workDuration = 25 * 60; 
    let breakDuration = 5 * 60; 

    // --- Tam Ekran API FonksiyonlarÄ± ---

    function toggleFullscreen(element) {
        if (element.requestFullscreen) {
            element.requestFullscreen();
        } else if (element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
        }
    }

    function exitFullscreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }

    // --- YardÄ±mcÄ± Fonksiyonlar ---

    function formatTime(totalSeconds) {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateTimerDisplay() {
        timerTime.textContent = formatTime(remainingTime);
        document.title = `${formatTime(remainingTime)} - ${isWorkTime ? "Ã‡ALIÅMA" : "MOLA"}`;
    }

    function startTimer() {
        if (!isRunning) {
            isRunning = true;
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();

                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    
                    alert(isWorkTime ? "Ã‡alÄ±ÅŸma SÃ¼resi Bitti! Mola BaÅŸlÄ±yor." : "Mola Bitti! Ã‡alÄ±ÅŸmaya DÃ¶n.");
                    
                    isWorkTime = !isWorkTime; 
                    remainingTime = isWorkTime ? workDuration : breakDuration;
                    
                    // Yeni zaman dilimini otomatik baÅŸlat
                    startTimer(); 
                }
            }, 1000);
        }
    }

    function pauseTimer() {
        if (isRunning) {
            clearInterval(timerInterval);
            isRunning = false;
        }
    }

    // Modal sÄ±fÄ±rlama ve tam ekrandan Ã§Ä±kÄ±ÅŸ
    function resetModal() {
        pauseTimer();
        pomodoroModal.style.display = 'none'; 
        exitFullscreen(); 
        document.title = 'Pomodoro Odaklanma TekniÄŸi - StudyFlow'; 
        window.location.reload(); 
    }

    // 1. "SayacÄ± BaÅŸlat" butonu: Modal'Ä± aÃ§ar ve seÃ§enekleri gÃ¶sterir.
    startPomodoroBtn.addEventListener('click', () => {
        pomodoroModal.style.display = 'flex';
        timerDisplay.style.display = 'none';
        
        document.querySelector('.pomodoro-options').style.display = 'block';
    });


    // 2. SÃ¼re SeÃ§eneklerini Dinle: SÃ¼re seÃ§ildiÄŸinde tam ekranÄ± aÃ§ar ve sayacÄ± baÅŸlatÄ±r.
    timeOptions.forEach(button => {
        button.addEventListener('click', (e) => {
            workDuration = parseInt(e.target.dataset.work) * 60;
            breakDuration = parseInt(e.target.dataset.break) * 60;
            remainingTime = workDuration;
            isWorkTime = true;
            updateTimerDisplay();
            document.querySelector('.pomodoro-options').style.display = 'none';
            timerDisplay.style.display = 'flex'; 
            toggleFullscreen(pomodoroModal); 
            startTimer();
        });
    });

    // 3. TarayÄ±cÄ±da ESC'ye basÄ±ldÄ±ÄŸÄ±nda tam ekrandan Ã§Ä±kÄ±ÅŸ
    document.addEventListener('fullscreenchange', () => {
        if (!document.fullscreenElement) {
            resetModal(); 
        }
    });

</script>
{% endblock scripts %}